{{- if semverCompare ">=1.31.0-0" .Capabilities.KubeVersion.Version }}
{{- range $name, $vac := .Values.volumeAttributeClasses }}
{{- if $vac.enabled }}
---
apiVersion: storage.k8s.io/v1beta1
kind: VolumeAttributesClass
metadata:
  name: {{ $name }}
  {{- if or $vac.annotations $.Values.globalAnnotations }}
  annotations:
    {{- with $.Values.globalAnnotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- with $vac.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- end }}
  {{- if or $vac.labels $.Values.globalLabels }}
  labels:
    {{- include "storage-class.labels" $ | nindent 4 }}
    {{- with $.Values.globalLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- with $vac.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- end }}
driverName: {{ $vac.driverName }}
{{- with $vac.parameters }}
parameters:
  {{- toYaml . | nindent 2 }}
{{- end }}
{{- end }}
{{- end }}
{{- else }}
{{- if .Values.volumeAttributeClasses }}
{{- range $name, $vac := .Values.volumeAttributeClasses }}
{{- if $vac.enabled }}
{{- fail (printf "VolumeAttributesClass '%s' requires Kubernetes 1.31.0+ (EKS) or 1.34.0+ (Vanilla). Current version: %s" $name $.Capabilities.KubeVersion.Version) }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
